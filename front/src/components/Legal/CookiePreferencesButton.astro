---
interface Props {
	text?: string;
	variant?: 'button' | 'link';
	class?: string;
}

const {
	text = 'Gestionar cookies',
	variant = 'button',
	class: className = '',
} = Astro.props;
---

{
	variant === 'button' ? (
		<button
			id="cookie-preferences-btn"
			class={`cookie-preferences-btn ${className}`}
			type="button"
		>
			{text}
		</button>
	) : (
		<a
			href="#"
			id="cookie-preferences-link"
			class={`cookie-preferences-link ${className}`}
		>
			{text}
		</a>
	)
}

<script>
	function openCookiePreferences(e: Event) {
		e.preventDefault();

		function waitForCookieConsent(callback: () => void, maxAttempts = 20) {
			let attempts = 0;

			const checkInterval = setInterval(() => {
				attempts++;

				if (typeof window !== 'undefined' && (window as any).CookieConsent) {
					clearInterval(checkInterval);
					callback();
				} else if (attempts >= maxAttempts) {
					clearInterval(checkInterval);
					console.error('Cookie Consent no se cargÃ³ correctamente');
				}
			}, 100);
		}

		waitForCookieConsent(() => {
			(window as any).CookieConsent.showPreferences();
		});
	}

	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initButtons);
	} else {
		initButtons();
	}

	function initButtons() {
		const btn = document.getElementById('cookie-preferences-btn');
		const link = document.getElementById('cookie-preferences-link');

		if (btn) {
			btn.addEventListener('click', openCookiePreferences);
		}

		if (link) {
			link.addEventListener('click', openCookiePreferences);
		}
	}
</script>

<style>
	.cookie-preferences-btn {
		position: absolute;
		bottom: -5.5rem;
		left: 1rem;
		padding: 0.5rem 1rem;
		background-color: #9b494b;
		color: #fff;
		border: none;
		border-radius: 0.375rem;
		cursor: pointer;
		font-weight: 500;
		transition: all 0.2s ease;
	}

	.cookie-preferences-btn:hover {
		background-color: #682c2d;
		color: #fff;
		transform: translateY(-1px);
	}

	.cookie-preferences-link {
		color: #85ccc6;
		text-decoration: underline;
		cursor: pointer;
		transition: color 0.2s ease;
	}

	.cookie-preferences-link:hover {
		color: #222;
	}

	.dark .cookie-preferences-link {
		color: #60a5fa;
	}

	.dark .cookie-preferences-link:hover {
		color: #93c5fd;
	}
</style>
