---
import type { languagesList } from '@/i18n/ui';
import { useTranslations } from '@/i18n/utils';
const currentLang = Astro.currentLocale || 'es';
const t = useTranslations(currentLang as keyof typeof languagesList);
const sentences = Astro.props;
---

<section class="h-sentence display">
	<div
		class="animated catchwords glider-containt multiple"
		style="max-width: 80%; margin:0 auto;"
		data-sentences-carousel
	>
		<ul class="catchwords__list glider-2">
			{
				sentences.sentences.map((sentence) => (
					<li class="testimonials__item">
						<p>{sentence.title}</p>
					</li>
				))
			}
		</ul>
	</div>
</section>

<script>
	function initSentencesCarousel() {
		const carouselWrapper = document.querySelector('[data-sentences-carousel]');
		if (!carouselWrapper) return;

		const observer = new IntersectionObserver(
			(entries) => {
				entries.forEach((entry) => {
					if (entry.isIntersecting) {
						observer.disconnect();

						requestAnimationFrame(() => {
							requestAnimationFrame(() => {
								const gliderElement = document.querySelector('.glider-2');
								if (!gliderElement || (gliderElement as any)._glider) return;

								const glider2 = new (window as any).Glider(gliderElement, {
									rewind: true,
									draggable: false,
									scrollLock: true,
									scrollLockDelay: 100,
									duration: 0.25,
									resizeLock: false,
									responsive: [
										{
											breakpoint: 300,
											settings: {
												slidesToShow: 1,
												slidesToScroll: 1,
												duration: 0.25,
											},
										},
										{
											breakpoint: 600,
											settings: {
												slidesToShow: 1,
												slidesToScroll: 1,
												duration: 0.25,
											},
										},
										{
											breakpoint: 1500,
											settings: {
												slidesToShow: 1,
												slidesToScroll: 1,
												duration: 0.25,
											},
										},
									],
								});

								let slideTimeout: number | null = null;
								let nextIndex = 1;
								const slidesCount = glider2.track.childElementCount;

								function slide() {
									slideTimeout = window.setTimeout(() => {
										if (nextIndex >= slidesCount) {
											nextIndex = 0;
										}
										glider2.scrollItem(nextIndex++);
									}, 6000);
								}

								glider2.ele.addEventListener('glider-animated', () => {
									if (slideTimeout) {
										window.clearTimeout(slideTimeout);
									}
									slide();
								});

								const visibilityObserver = new IntersectionObserver(
									(entries) => {
										entries.forEach((entry) => {
											if (!entry.isIntersecting && slideTimeout) {
												window.clearTimeout(slideTimeout);
											} else if (entry.isIntersecting) {
												slide();
											}
										});
									},
									{ threshold: 0.5 },
								);

								visibilityObserver.observe(gliderElement);

								slide();

								carouselWrapper.classList.add('glider-loaded');
							});
						});
					}
				});
			},
			{
				rootMargin: '150px',
			},
		);

		observer.observe(carouselWrapper);
	}

	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initSentencesCarousel);
	} else {
		initSentencesCarousel();
	}
</script>

<style>
	.h-sentence {
		position: relative;
		width: 100%;
		padding-top: 100px;
		padding-bottom: 100px;
		background-image: url('../../assets/img/sentence_background_img.jpg');
		background-size: cover;
		background-position: top center;
		background-repeat: no-repeat;
		overflow: hidden;
		background-attachment: fixed;
	}

	.testimonials__item > p {
		padding: 0;
		font-size: 1.5rem;
		text-align: center;
		font-style: italic;
		width: 100%;
	}

	.h-sentence > div {
		background: #ffffff57;
	}

	.h-sentence > p,
	.h-sentence > div > p {
		margin: 0;
		padding: 0;
		font-size: 1.5rem;
		text-align: center;
		font-style: italic;
	}

	.catchwords {
		padding: 50px 0;
	}

	.catchwords__list {
		display: flex;
		overflow-x: hidden;
	}

	.catchwords > ul > div > li > div {
		display: flex;
	}

	.glider-containt[data-sentences-carousel] {
		opacity: 0;
		transition: opacity 0.4s ease-in-out;
	}

	.glider-containt[data-sentences-carousel].glider-loaded {
		opacity: 1;
	}

	.catchwords__list {
		will-change: transform;
	}
</style>
